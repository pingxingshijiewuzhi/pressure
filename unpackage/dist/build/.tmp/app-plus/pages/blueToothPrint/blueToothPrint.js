(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/blueToothPrint/blueToothPrint"],{"0d34":function(e,t,n){"use strict";n.r(t);var i=n("cb8a"),a=n("a026");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("6ef4");var c,o=n("f0c5"),u=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],c);t["default"]=u.exports},"0da4":function(e,t,n){"use strict";(function(e){n("aee2"),n("921b");i(n("66fd"));var t=i(n("0d34"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("6e42")["createPage"])},"6ef4":function(e,t,n){"use strict";var i=n("b072"),a=n.n(i);a.a},"8a80":function(e,t,n){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=l(n("4795")),r=l(n("bc17")),c=l(n("6fd8")),o=l(n("da65")),u=l(n("4877")),s=l(n("a32c"));function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n,i,a,r,c){try{var o=e[r](c),u=o.value}catch(s){return void n(s)}o.done?t(u):Promise.resolve(u).then(i,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function c(e){f(r,i,a,c,o,"next",e)}function o(e){f(r,i,a,c,o,"throw",e)}c(void 0)}))}}var v=new s.default,h={components:{},data:function(){return{baseUrl:this.$common.baseUrl,printdata:[],isOpenBle:!1,devicesList:[],serviceList:[],deviceId:"",canvas_width:240,canvas_height:240,year:(new Date).getFullYear(),week:["日","一","二","三","四","五","六"][(new Date).getDay()],month:(new Date).getMonth()+1,day:(new Date).getDate(),avatar:e.getStorageSync("userinfo").avatar,username:e.getStorageSync("userinfo").username}},onUnload:function(){v.closeBLEConnection(),v.closeBluetoothAdapter()},onLoad:function(e){this.printdata=JSON.parse(e.printdata),v.openBluetoothAdapter()},methods:{startBluetoothDeviceDiscovery:function(){e.showLoading({title:"蓝牙搜索中"});var t=this;t.devicesList=[],setTimeout((function(){e.startBluetoothDevicesDiscovery({success:function(n){e.onBluetoothDeviceFound((function(e){i("log","发现设备: "+JSON.stringify(e)," at pages\\blueToothPrint\\blueToothPrint.vue:122"),t.devicesList.some((function(t){return t.deviceId===e.devices[0].deviceId}))||t.devicesList.push(e.devices[0])}))},fail:function(n){e.hideLoading(),t.showToast("搜索设备失败"+JSON.stringify(err))}})}),200)},stopBluetoothDevicesDiscovery:function(){e.hideLoading(),v.stopBluetoothDevicesDiscovery()},select_deviceId:function(t){var n=this;return d(a.default.mark((function r(){var c;return a.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.deviceId=t.deviceId,v.deviceId=t.deviceId,e.setStorageSync("deviceId",v.deviceId),n.serviceList=[],a.prev=4,a.next=7,v.createBLEConnection();case 7:return a.sent,a.next=10,v.getBLEDeviceServices();case 10:c=a.sent,i("log","获取服务: "+JSON.stringify(c)," at pages\\blueToothPrint\\blueToothPrint.vue:160"),n.serviceList=c,i("log",n.serviceList,"获取设备"," at pages\\blueToothPrint\\blueToothPrint.vue:163"),n.select_service(n.serviceList[1]),a.next=20;break;case 17:a.prev=17,a.t0=a["catch"](4),i("log","e: "+JSON.stringify(a.t0)," at pages\\blueToothPrint\\blueToothPrint.vue:167");case 20:case"end":return a.stop()}}),r,null,[[4,17]])})))()},select_service:function(t){return d(a.default.mark((function n(){return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return v.serviceId=t.uuid,e.setStorageSync("serviceId",t.uuid),n.prev=2,n.next=5,v.getBLEDeviceCharacteristics();case 5:n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](2),i("log","e: "+JSON.stringify(n.t0)," at pages\\blueToothPrint\\blueToothPrint.vue:181");case 11:case"end":return n.stop()}}),n,null,[[2,8]])})))()},pickUpOnce:function(){v.notifyBLECharacteristicValue();var e=this;setTimeout((function(){e.writeBLECharacteristicValue()}),500)},writeBLECharacteristicValue:function(){var e=this;return d(a.default.mark((function t(){var n,i,u,s,l;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n=e.printdata,i=e.printdata.length,u=new r.default,u.print(o.default.formatTime(new Date)).print(c.default.fillLine()).print(c.default.inline("NAME","傻逼张峰")).print(c.default.inline("DATE",o.default.formatTime(new Date))).print(c.default.fillLine()).setSize(2,2).print("TIME    L    R").println(),s=0;s<i;s++)u.setSize(1,1).print("".concat(n[s].createtime,"\t").concat(n[s].l,"\t  ").concat(n[s].r));u.print("").print("").print("").print(""),l=u.buffer(),e.printbuffs(l);case 8:case"end":return t.stop()}}),t)})))()},printbuffs:function(e){for(var t=20,n=20,i=0,a=0,r=e.byteLength;i<r;i+=t,a++){var c=e.slice(i,i+t<=r?i+t:r);setTimeout(this.printbuff,a*n,c)}},printbuff:function(e){v.writeBLECharacteristicValue(e)},get_Qrcode:function(){var t=this;return new Promise((function(n,a){var r=e.createCanvasContext("shareCanvas");i("log",t.canvas_width," at pages\\blueToothPrint\\blueToothPrint.vue:282"),r.clearRect(0,0,t.canvas_width,t.canvas_height),(0,u.default)({canvasId:"shareCanvas",text:String("xiaonibaba.com"),width:t.canvas_width,height:t.canvas_height,callback:function(a){setTimeout((function(){i("log",t.canvas_width," at pages\\blueToothPrint\\blueToothPrint.vue:292"),e.canvasGetImageData({canvasId:"shareCanvas",x:0,y:0,width:t.canvas_width,height:t.canvas_height,success:function(e){n(o.default.zip_image(e))}})}),1e3)}})}))},back:function(){e.navigateBack({delta:1})}}};t.default=h}).call(this,n("6e42")["default"],n("0de9")["default"])},a026:function(e,t,n){"use strict";n.r(t);var i=n("8a80"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},b072:function(e,t,n){},cb8a:function(e,t,n){"use strict";var i,a=function(){var e=this,t=e.$createElement,n=(e._self._c,e.__map(e.devicesList,(function(t,n){var i=Math.max(100+t.RSSI,0);return{$orig:e.__get_orig(t),g0:i}})));e.$mp.data=Object.assign({},{$root:{l0:n}})},r=[];n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i}))}},[["0da4","common/runtime","common/vendor"]]]);