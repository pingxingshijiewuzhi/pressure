(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/realtime/realtime"],{"0ced":function(e,t,a){"use strict";a.r(t);var i=a("830f"),c=a.n(i);for(var n in i)"default"!==n&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=c.a},1563:function(e,t,a){"use strict";var i=a("d64e"),c=a.n(i);c.a},4204:function(e,t,a){"use strict";a.r(t);var i=a("ee0d"),c=a("0ced");for(var n in c)"default"!==n&&function(e){a.d(t,e,(function(){return c[e]}))}(n);a("1563");var s,r=a("f0c5"),o=Object(r["a"])(c["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);t["default"]=o.exports},"830f":function(e,t,a){"use strict";(function(e,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={data:function(){return{startStatus:!0,boothStatus:!1,baseUrl:this.$common.baseUrl,langch:{chaxun:"查询",shishi:"实时数据",good:"非常好",satisfactory:"还不错",advise:"建议重测",advisebadly:"必须重测",booth:"连接蓝牙"},langen:{booth:"booth",measurement:"measurement",chaxun:"select",shishi:"Timeing",good:"good",satisfactory:"satisfactory",advise:"advise",advisebadly:"advisebadly"},langtype:"",hour:(new Date).getHours(),min:(new Date).getMinutes(),sec:(new Date).getSeconds(),year:(new Date).getFullYear(),week:["日","一","二","三","四","五","六"][(new Date).getDay()],month:(new Date).getMonth()+1,day:(new Date).getDate(),avatar:e.getStorageSync("userinfo").avatar,username:e.getStorageSync("userinfo").username,listbuffuer:{},list:{},helleo:"sd",bluetooth:[],isLink:[],serverList:[],characteristics:[],readCode:"",readCodeMsg:"",serviceId:"",characteristicId:"",value:"0102",returnMessage:"",macAddress:"",macValue:"",connectbloothindex:""}},onShow:function(){this.langtype=e.getStorageSync("lang")?e.getStorageSync("lang"):"CH",this.getTime(),this.notifyBLECharacteristicValueChange(e.getStorageSync("pressuredeviceId"),e.getStorageSync("pressureserviceId"),e.getStorageSync("characteristicId"))},onHide:function(){},methods:{gobluetooth:function(){var t=this;if(a("log",e.getStorageSync("deviceId"),"???"," at pages\\realtime\\realtime.vue:233"),e.getStorageSync("deviceId")){var i=e.getStorageSync("deviceId");e.closeBLEConnection({deviceId:i,success:function(e){a("log",e,"断开蓝牙链接"," at pages\\realtime\\realtime.vue:239")},fail:function(e){a("log",e," at pages\\realtime\\realtime.vue:242")}})}this.boothStatus=!0,e.openBluetoothAdapter({success:function(e){a("log","初始化蓝牙成功:"+e.errMsg," at pages\\realtime\\realtime.vue:249"),t.startBluetoothDeviceDiscovery()}})},startBluetoothDeviceDiscovery:function(){var t=this;e.startBluetoothDevicesDiscovery({success:function(e){a("log",e," at pages\\realtime\\realtime.vue:260"),t.onBluetoothDeviceFound()},fail:function(t){e.showToast({icon:"none",title:"查找设备失败！",duration:3e3})}})},stopBluetoothDevicesDiscovery:function(){e.stopBluetoothDevicesDiscovery({success:function(e){a("log","停止搜索蓝牙设备:"+e.errMsg," at pages\\realtime\\realtime.vue:278")},fail:function(e){a("log","停止搜索蓝牙设备失败，错误码："+e.errCode," at pages\\realtime\\realtime.vue:281")}})},onBluetoothDeviceFound:function(){var t=this;e.onBluetoothDeviceFound((function(e){a("log","开始监听寻找到新设备的事件"," at pages\\realtime\\realtime.vue:290"),a("log",e," at pages\\realtime\\realtime.vue:291"),t.getBluetoothDevices()}))},getBluetoothDevices:function(){var t=this;a("log","获取蓝牙设备"," at pages\\realtime\\realtime.vue:299"),e.getBluetoothDevices({success:function(i){a("log","获取蓝牙设备成功:"+JSON.stringify(i.devices)," at pages\\realtime\\realtime.vue:302"),t.bluetooth=i.devices,t.bluetooth.forEach((function(e){t.isLink.push(0)})),e.setStorageSync("isLink",t.isLink)}})},closeBLEConnection:function(t,i){var c=this;e.closeBLEConnection({deviceId:t,success:function(e){c.isLink.splice(i,1,4),a("log",e," at pages\\realtime\\realtime.vue:317")}})},createBLEConnection:function(t,i){var c=this;this.boothStatus=!1,this.connectbloothindex=i,e.setStorageSync("connectbloothindex",i),this.deviceId=t,2!=this.isLink[i]&&(this.isLink.splice(i,1,1),e.createBLEConnection({deviceId:this.deviceId,success:function(e){a("log","连接蓝牙成功"," at pages\\realtime\\realtime.vue:337"),c.isLink.splice(i,1,2),c.stopBluetoothDevicesDiscovery(),c.getBLEDeviceServices(c.deviceId,i)},fail:function(e){c.isLink.splice(i,1,3),a("log",e," at pages\\realtime\\realtime.vue:344")}}))},getBLEDeviceServices:function(t,i){var c=this;setTimeout((function(){e.getBLEDeviceServices({deviceId:t,success:function(e){c.serverList=e.services,e.services.forEach((function(e){-1!=e.uuid.indexOf("FFE0")&&(c.serviceId=e.uuid,a("log","获取的服务idserverId:",c.serviceId," at pages\\realtime\\realtime.vue:360"),c.getBLEDeviceCharacteristics(c.deviceId))}))}})}),1e3)},getBLEDeviceCharacteristics:function(t){var i=this;e.setStorageSync("pressuredeviceId",t),e.setStorageSync("pressureserviceId",this.serviceId),a("log","进入特征"," at pages\\realtime\\realtime.vue:374"),setTimeout((function(){e.getBLEDeviceCharacteristics({deviceId:t,serviceId:i.serviceId,success:function(t){i.characteristics=t.characteristics,t.characteristics.forEach((function(t){-1!=t.uuid.indexOf("FFE1")&&(i.characteristicId=t.uuid,e.setStorageSync("characteristicId",i.characteristicId),a("log","特征值idcharacteristicId:",i.characteristicId," at pages\\realtime\\realtime.vue:387"),i.notifyBLECharacteristicValueChange(i.deviceId,i.serviceId,i.characteristicId))}))},fail:function(e){a("log",e," at pages\\realtime\\realtime.vue:393")}})}),2e3)},notifyBLECharacteristicValueChange:function(t,i,c){var n=this;a("log",c,"有特征值？"," at pages\\realtime\\realtime.vue:400"),e.notifyBLECharacteristicValueChange({state:!0,deviceId:t,serviceId:i,characteristicId:c,success:function(e){n.startStatus?n.onBLECharacteristicValueChange(t):a("log","不需要再次开启监听"," at pages\\realtime\\realtime.vue:414")},fail:function(e){a("log","notifyBLECharacteristicValueChange success",e.errMsg," at pages\\realtime\\realtime.vue:418")}})},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)}));return t.join("")},onBLECharacteristicValueChange:function(t){var i=this,c=this;this.startStatus=!1,a("log",1," at pages\\realtime\\realtime.vue:436"),e.onBLECharacteristicValueChange((function(t){if(a("log",i.ab2hex(t.value),"变化的数据"," at pages\\realtime\\realtime.vue:439"),e.getStorageSync("changevalue")!=i.ab2hex(t.value)){e.setStorageSync("changevalue",i.ab2hex(t.value));var n={code16:i.ab2hex(t.value)};i.$common.requests("/api/index/addData",n).then((function(t){1==t.data.code&&(a("log",t.data.data,"请求次数"," at pages\\realtime\\realtime.vue:452"),e.setStorageSync("changeboothvalue",t.data.data),c.getdata(t.data.data))}))}else a("log",5555," at pages\\realtime\\realtime.vue:441")}))},getdata:function(e){var t=getCurrentPages(),i=t[t.length-1];t[t.length-2];i.$vm.list=e,a("log",e," at pages\\realtime\\realtime.vue:466"),this.$forceUpdate()},back:function(){e.reLaunch({url:"../personalCenter/personalCenter"})},getTime:function(){var e=this;setInterval((function(){var t=new Date;e.min=t.getMinutes(),e.hour=t.getHours(),e.sec=t.getSeconds(),e.year=t.getFullYear(),e.month=t.getMonth()+1;var a=["日","一","二","三","四","五","六"];e.week=a[t.getDay()],e.day=t.getDate(),e.min=t.getMinutes()}),1e3)},searchdata:function(){e.navigateTo({url:"../alldayData/alldayData"})},canclemodify:function(){this.boothStatus=!1}}};t.default=i}).call(this,a("6e42")["default"],a("0de9")["default"])},d64e:function(e,t,a){},ee0d:function(e,t,a){"use strict";var i,c=function(){var e=this,t=e.$createElement,a=(e._self._c,Object.getOwnPropertyNames(e.list)),i=Object.getOwnPropertyNames(e.list);e.$mp.data=Object.assign({},{$root:{g0:a,g1:i}})},n=[];a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}))},f84e:function(e,t,a){"use strict";(function(e){a("aee2"),a("921b");i(a("66fd"));var t=i(a("4204"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,a("6e42")["createPage"])}},[["f84e","common/runtime","common/vendor"]]]);