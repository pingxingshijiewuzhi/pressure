(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bluetooth/bluetooth"],{"07af":function(e,t,o){"use strict";o.r(t);var c=o("1289"),i=o.n(c);for(var a in c)"default"!==a&&function(e){o.d(t,e,(function(){return c[e]}))}(a);t["default"]=i.a},1289:function(e,t,o){"use strict";(function(e,o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c={data:function(){return{baseUrl:this.$common.baseUrl,avatar:e.getStorageSync("userinfo").avatar,username:e.getStorageSync("userinfo").username,rSelect:[],typeStus:0,bluetooth:[],isLink:[],serverList:[],characteristics:[],readCode:"",readCodeMsg:"",serviceId:"",characteristicId:"",value:"0102",returnMessage:"",macAddress:"",macValue:""}},onLoad:function(){var t=this;e.openBluetoothAdapter({success:function(e){o("log","初始化蓝牙成功:"+e.errMsg," at pages\\bluetooth\\bluetooth.vue:66"),t.startBluetoothDeviceDiscovery()}})},methods:{gocontrolpanel:function(){e.reLaunch({url:"/pages/personalCenter/personalCenter"})},startBluetoothDeviceDiscovery:function(){var t=this;e.startBluetoothDevicesDiscovery({success:function(e){o("log",e," at pages\\bluetooth\\bluetooth.vue:83"),t.onBluetoothDeviceFound()},fail:function(t){e.showToast({icon:"none",title:"查找设备失败！",duration:3e3})}})},stopBluetoothDevicesDiscovery:function(){e.stopBluetoothDevicesDiscovery({success:function(e){o("log","停止搜索蓝牙设备:"+e.errMsg," at pages\\bluetooth\\bluetooth.vue:101")},fail:function(e){o("log","停止搜索蓝牙设备失败，错误码："+e.errCode," at pages\\bluetooth\\bluetooth.vue:104")}})},onBluetoothDeviceFound:function(){var t=this;o("log","监听寻找新设备"," at pages\\bluetooth\\bluetooth.vue:112"),e.onBluetoothDeviceFound((function(e){o("log","开始监听寻找到新设备的事件"," at pages\\bluetooth\\bluetooth.vue:115"),o("log",e," at pages\\bluetooth\\bluetooth.vue:116"),t.getBluetoothDevices()}))},getBluetoothDevices:function(){var t=this;o("log","获取蓝牙设备"," at pages\\bluetooth\\bluetooth.vue:124"),e.getBluetoothDevices({success:function(e){o("log","获取蓝牙设备成功:"+JSON.stringify(e.devices)," at pages\\bluetooth\\bluetooth.vue:127"),t.bluetooth=e.devices,t.bluetooth.forEach((function(e){t.isLink.push(0)}))}})},closeBLEConnection:function(t,c){var i=this;e.closeBLEConnection({deviceId:t,success:function(e){i.isLink.splice(c,1,4),o("log",e," at pages\\bluetooth\\bluetooth.vue:142")}})},createBLEConnection:function(t,c){var i=this;o("log",t,"压力测试手动连接设备id"," at pages\\bluetooth\\bluetooth.vue:148"),this.deviceId=t,2!=this.isLink[c]&&(this.isLink.splice(c,1,1),e.createBLEConnection({deviceId:this.deviceId,success:function(e){o("log",e," at pages\\bluetooth\\bluetooth.vue:158"),i.isLink.splice(c,1,2),i.stopBluetoothDevicesDiscovery(),i.getBLEDeviceServices(i.deviceId,c)},fail:function(e){i.isLink.splice(c,1,3),o("log",e," at pages\\bluetooth\\bluetooth.vue:165")}}))},getBLEDeviceServices:function(t,c){var i=this;setTimeout((function(){e.getBLEDeviceServices({deviceId:t,success:function(e){o("log","device services:",e," at pages\\bluetooth\\bluetooth.vue:176"),i.serverList=e.services,e.services.forEach((function(e){-1!=e.uuid.indexOf("FFE0")&&(i.serviceId=e.uuid,o("log","serverId:",i.serviceId," at pages\\bluetooth\\bluetooth.vue:182"),i.getBLEDeviceCharacteristics(i.deviceId))}))}})}),1e3)},getBLEDeviceCharacteristics:function(t){var c=this;e.setStorageSync("pressuredeviceId",t),e.setStorageSync("pressureserviceId",this.serviceId),o("log","进入特征"," at pages\\bluetooth\\bluetooth.vue:196"),setTimeout((function(){e.getBLEDeviceCharacteristics({deviceId:t,serviceId:c.serviceId,success:function(t){o("log",t," at pages\\bluetooth\\bluetooth.vue:204"),c.characteristics=t.characteristics,t.characteristics.forEach((function(t){-1!=t.uuid.indexOf("FFE1")&&(c.characteristicId=t.uuid,e.setStorageSync("characteristicId",c.characteristicId),o("log","characteristicId:",c.characteristicId," at pages\\bluetooth\\bluetooth.vue:210"),c.notifyBLECharacteristicValueChange(c.deviceId))}))},fail:function(e){o("log",e," at pages\\bluetooth\\bluetooth.vue:216")}})}),2e3)},notifyBLECharacteristicValueChange:function(t){e.notifyBLECharacteristicValueChange({state:!0,deviceId:t,serviceId:this.serviceId,characteristicId:this.characteristicId,success:function(e){o("log","notifyBLECharacteristicValueChange success",e.errMsg," at pages\\bluetooth\\bluetooth.vue:232")},fail:function(e){o("log","notifyBLECharacteristicValueChange success",e.errMsg," at pages\\bluetooth\\bluetooth.vue:236")}})},ab2hex:function(e){var t=Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)}));return t.join("")},onBLECharacteristicValueChange:function(t){var c=this;e.onBLECharacteristicValueChange((function(e){o("log","characteristic ".concat(e.characteristicId," has changed, now is ").concat(e.value)," at pages\\bluetooth\\bluetooth.vue:252"),o("log",new Uint8Array(e.value)," at pages\\bluetooth\\bluetooth.vue:253"),o("log",c.ab2hex(e.value)," at pages\\bluetooth\\bluetooth.vue:254"),c.macAddress=e.deviceId,c.macValue=c.ab2hex(e.value)}))},readBLECharacteristicValue:function(){var t=this;e.readBLECharacteristicValue({deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:this.characteristicId,success:function(e){o("log","readBLECharacteristicValue:",e," at pages\\bluetooth\\bluetooth.vue:272"),t.readCode=e.errCode,t.readCodeMsg=e.errMsg,t.onBLECharacteristicValueChange(t.deviceId)},fail:function(e){o("log","readBLECharacteristicValue:",e," at pages\\bluetooth\\bluetooth.vue:278"),t.readCode=e.errCode,t.readCodeMsg=e.errMsg,t.onBLECharacteristicValueChange(t.deviceId)}})},selectType:function(e){this.typeStus=e},back:function(){e.navigateBack({delta:1})}}};t.default=c}).call(this,o("6e42")["default"],o("0de9")["default"])},"30f4":function(e,t,o){"use strict";var c,i=function(){var e=this,t=e.$createElement;e._self._c},a=[];o.d(t,"b",(function(){return i})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return c}))},bd12:function(e,t,o){"use strict";o.r(t);var c=o("30f4"),i=o("07af");for(var a in i)"default"!==a&&function(e){o.d(t,e,(function(){return i[e]}))}(a);o("e8d2");var s,u=o("f0c5"),r=Object(u["a"])(i["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],s);t["default"]=r.exports},bdb1:function(e,t,o){},e8d2:function(e,t,o){"use strict";var c=o("bdb1"),i=o.n(c);i.a},ede3:function(e,t,o){"use strict";(function(e){o("aee2"),o("921b");c(o("66fd"));var t=c(o("bd12"));function c(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("6e42")["createPage"])}},[["ede3","common/runtime","common/vendor"]]]);